<div class="btn-group">
  <%= link_to t(".clinical_summary", default: "Clinical Summary"), active_report_path(@tasks.id), class: "btn btn-link" %>
  <%= link_to t("conemo.views.shared.register").capitalize + " " + AdditionalContact.model_name.human.downcase, new_participant_additional_contact_path(@tasks.id), class: "btn btn-link" %>
</div>

<div class="row">
  <div class="col-sm-4 col-md-3">
    <table class="table table-condensed">
      <tbody>
        <tr>
          <td>scheduled but not due</td>
        </tr>
        <tr class="success">
          <td>confirmed</td>
        </tr>
        <tr class="info">
          <td>active due</td>
        </tr>
        <tr class="warning">
          <td>cancelled</td>
        </tr>
        <tr class="danger">
          <td>overdue</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="progress">
  <% @tasks.scheduled_tasks.each_with_index do |task, i| %>
    <%= content_tag("div",
                    class: "progress-bar progress-bar-#{ task.css_class }",
                    style: "width: #{ 100 / @tasks.scheduled_tasks.count }%; border-right: 1px solid;") do %>
      <span><%= task %></span>
    <% end %>
  <% end %>
</div>

<%= @tasks.active_tasks.count %> <%= NurseTask.model_name.human(count: @tasks.active_tasks.count) %>, <%= @tasks.overdue_tasks.count %> overdue

<% @tasks.active_tasks.each do |task| %>
  <div class="panel panel-default">
    <div class="panel-heading"><%= task %> <small><%= time_ago_in_words task.scheduled_at %> ago</small></div>

    <div class="btn-group" role="group" aria-label="Actions">
      <% if task.alert? %>
        <%= link_to "Mark as resolved",
                    new_polymorphic_path([:participant, task.target], { participant_id: @tasks.id }),
                    { class: "btn btn-default" } %>
        <%= button_to "Contact Supervisor",
                      notify_supervisor_participant_task_path(participant_id: @tasks.id, id: task.id),
                      { class: "btn btn-default", data: { confirm: "are you sure you want to notify the supervisor that you need help?" } } %>
      <% else %>
        <%= link_to t("conemo.views.shared.confirm"),
                    new_polymorphic_path([:participant, task.target], { participant_id: @tasks.id }),
                    { class: "btn btn-link" } %>
        <%= link_to t("conemo.views.shared.cancel_button"),
                      new_participant_task_scheduled_task_cancellation_path(participant_id: @tasks.id, task_id: task.id),
                      { class: "btn btn-link" } %>
        <%= link_to t("conemo.views.shared.reschedule").capitalize,
                    edit_participant_task_path(participant_id: @tasks.id, id: task.id),
                    { class: "btn btn-link" } %>
      <% end %>
    </div>

    <% if task.alert? && @tasks.latest_notification(task.id) %>
      <div class="panel-body">
        <p style="display: inline-block;">last supervisor contact sent <%= l @tasks.latest_notification(task.id).created_at, format: :long %></p>
        <%= button_to "clear",
                      clear_latest_supervisor_notification_participant_task_path(participant_id: @tasks.id, id: task.id),
                      { form: { style: "display: inline-block;" }, method: :delete, class: "btn btn-default", data: { confirm: "are you sure you want to clear this?" } } %>
      </div>
    <% end %>
  </div>
<% end %>
